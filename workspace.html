<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workspace - Consciousness Revolution</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg: #0a0a0f;
            --card: #12121a;
            --accent: #00ff88;
            --text: #ffffff;
            --dim: #888;
            --border: #333;
            --todo: #3a3a4a;
            --doing: #4a4a00;
            --done: #003a1a;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 20px;
            margin-bottom: 30px;
        }

        .header h1 {
            color: var(--accent);
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0,255,136,0.5);
        }

        .header p {
            color: var(--dim);
        }

        /* Kanban Board */
        .kanban {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .kanban-column {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--border);
        }

        .kanban-column h2 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .kanban-column.todo h2 { color: #00aaff; }
        .kanban-column.doing h2 { color: #ffaa00; }
        .kanban-column.done h2 { color: var(--accent); }

        .task-count {
            background: rgba(255,255,255,0.1);
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: auto;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 200px;
        }

        .task-card {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
            cursor: pointer;
            transition: all 0.3s;
        }

        .task-card:hover {
            transform: translateX(5px);
            background: rgba(255,255,255,0.1);
        }

        .task-card.todo { border-left-color: #00aaff; }
        .task-card.doing { border-left-color: #ffaa00; }
        .task-card.done { border-left-color: var(--accent); }

        .task-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .task-desc {
            font-size: 0.9em;
            color: var(--dim);
            margin-bottom: 10px;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8em;
            color: var(--dim);
        }

        .task-assignee {
            background: rgba(0,255,136,0.2);
            color: var(--accent);
            padding: 3px 10px;
            border-radius: 12px;
        }

        .task-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .task-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: bold;
            transition: all 0.2s;
        }

        .task-btn.claim {
            background: #00aaff;
            color: #000;
        }

        .task-btn.complete {
            background: var(--accent);
            color: #000;
        }

        .task-btn.unclaim {
            background: #ff6644;
            color: #fff;
        }

        .task-btn:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }

        /* Bottom Grid */
        .bottom-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
        }

        .card h2 {
            color: var(--accent);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        /* Team Chat */
        .chat-messages {
            height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }

        .chat-message {
            margin-bottom: 12px;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .chat-meta {
            font-size: 0.8em;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
        }

        .chat-input button {
            padding: 12px 24px;
            background: var(--accent);
            color: #000;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .chat-input button:hover {
            opacity: 0.8;
        }

        /* Team Roster */
        .team-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .team-member {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .team-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), #00aaff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .team-info {
            flex: 1;
        }

        .team-name {
            font-weight: bold;
        }

        .team-role {
            font-size: 0.85em;
            color: var(--dim);
        }

        .team-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent);
        }

        .team-status.offline {
            background: var(--dim);
        }

        /* Quick Links */
        .quick-links {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quick-link {
            padding: 12px;
            background: rgba(0,255,136,0.1);
            border-radius: 8px;
            text-decoration: none;
            color: var(--text);
            border-left: 4px solid var(--accent);
            transition: all 0.3s;
        }

        .quick-link:hover {
            background: rgba(0,255,136,0.2);
            transform: translateX(5px);
        }

        .link-title {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .link-url {
            font-size: 0.85em;
            color: var(--dim);
        }

        /* Add Task Form */
        .add-task-form {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .add-task-form input,
        .add-task-form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
        }

        .add-task-form textarea {
            min-height: 60px;
            resize: vertical;
        }

        @media (max-width: 1024px) {
            .kanban {
                grid-template-columns: 1fr;
            }

            .bottom-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>YOUR WORKSPACE</h1>
        <p>Consciousness Revolution Team HQ - Everything In One Place</p>
    </div>

    <!-- Kanban Board -->
    <div class="kanban">
        <!-- TODO Column -->
        <div class="kanban-column todo">
            <h2>
                TODO
                <span class="task-count" id="todo-count">0</span>
            </h2>
            <div class="task-list" id="todo-list">
                <!-- Tasks load here -->
            </div>
        </div>

        <!-- DOING Column -->
        <div class="kanban-column doing">
            <h2>
                DOING
                <span class="task-count" id="doing-count">0</span>
            </h2>
            <div class="task-list" id="doing-list">
                <!-- Tasks load here -->
            </div>
        </div>

        <!-- DONE Column -->
        <div class="kanban-column done">
            <h2>
                DONE
                <span class="task-count" id="done-count">0</span>
            </h2>
            <div class="task-list" id="done-list">
                <!-- Tasks load here -->
            </div>
        </div>
    </div>

    <div class="bottom-grid">
        <!-- Left Side: Team Chat -->
        <div class="card">
            <h2>Team Chat</h2>
            <div class="chat-messages" id="chat-messages">
                <!-- Messages load here -->
            </div>
            <div class="chat-input">
                <input type="text" id="chat-input" placeholder="Message the team...">
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>

        <!-- Right Side: Team & Links -->
        <div style="display: flex; flex-direction: column; gap: 20px;">
            <!-- Team Roster -->
            <div class="card">
                <h2>Team Online</h2>
                <div class="team-list" id="team-list">
                    <!-- Team loads here -->
                </div>
            </div>

            <!-- Quick Links -->
            <div class="card">
                <h2>Quick Links</h2>
                <div class="quick-links">
                    <a href="https://consciousnessrevolution.io" target="_blank" class="quick-link">
                        <div class="link-title">Main Site</div>
                        <div class="link-url">consciousnessrevolution.io</div>
                    </a>
                    <a href="https://consciousnessrevolution.io/help.html" target="_blank" class="quick-link">
                        <div class="link-title">Help Docs</div>
                        <div class="link-url">Common questions & guides</div>
                    </a>
                    <a href="https://github.com/overkillkulture/consciousness-revolution" target="_blank" class="quick-link">
                        <div class="link-title">GitHub Repo</div>
                        <div class="link-url">Code repository (optional)</div>
                    </a>
                    <a href="EMPLOYEE_BOOT_PROTOCOL.md" target="_blank" class="quick-link">
                        <div class="link-title">Boot Protocol</div>
                        <div class="link-url">First-time setup guide</div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get user name from localStorage or prompt
        let userName = localStorage.getItem('userName');
        if (!userName) {
            userName = prompt('Enter your name:');
            if (userName) {
                localStorage.setItem('userName', userName);
            }
        }

        // Local storage keys
        const TASKS_KEY = 'workspace_tasks';
        const CHAT_KEY = 'workspace_chat';
        const TEAM_KEY = 'workspace_team';

        // Initialize data structures
        let tasks = JSON.parse(localStorage.getItem(TASKS_KEY) || '[]');
        let chatMessages = JSON.parse(localStorage.getItem(CHAT_KEY) || '[]');
        let team = JSON.parse(localStorage.getItem(TEAM_KEY) || '[]');

        // Add default tasks if empty
        if (tasks.length === 0) {
            tasks = [
                {
                    id: 1,
                    title: 'Complete onboarding checklist',
                    desc: 'Read EMPLOYEE_BOOT_PROTOCOL.md, bookmark workspace.html, find your name in team roster',
                    status: 'todo',
                    assignee: null,
                    created: new Date().toISOString()
                },
                {
                    id: 2,
                    title: 'Test workspace features',
                    desc: 'Claim this task, send a chat message, check all Quick Links work',
                    status: 'todo',
                    assignee: null,
                    created: new Date().toISOString()
                },
                {
                    id: 3,
                    title: 'Introduce yourself in team chat',
                    desc: 'Share: Your name, what excites you about consciousness work, one skill you bring',
                    status: 'todo',
                    assignee: null,
                    created: new Date().toISOString()
                },
                {
                    id: 4,
                    title: 'Read SYSTEM_MAP.md',
                    desc: 'Understand what all the pieces are and where they live. This is your orientation.',
                    status: 'todo',
                    assignee: null,
                    created: new Date().toISOString()
                },
                {
                    id: 5,
                    title: 'Review TOOLS_LIST.md',
                    desc: 'See what tools are available and what each one does. Pick one to explore.',
                    status: 'todo',
                    assignee: null,
                    created: new Date().toISOString()
                },
                {
                    id: 6,
                    title: 'Test the Manipulation Detector tool',
                    desc: 'Go to manipulation-detector.html and test it with real social media content',
                    status: 'todo',
                    assignee: null,
                    created: new Date().toISOString()
                },
                {
                    id: 7,
                    title: 'Report first bug or improvement',
                    desc: 'Use the system, find something that could be better, post it in team chat',
                    status: 'todo',
                    assignee: null,
                    created: new Date().toISOString()
                },
                {
                    id: 8,
                    title: 'Complete Seven Domains assessment',
                    desc: 'Visit the main site, take the Seven Domains test, see your consciousness score',
                    status: 'todo',
                    assignee: null,
                    created: new Date().toISOString()
                }
            ];
            saveTasks();
        }

        // Register current user in team
        registerUser();

        function registerUser() {
            if (!userName) return;

            const existingUser = team.find(m => m.name === userName);
            if (!existingUser) {
                team.push({
                    name: userName,
                    lastSeen: new Date().toISOString(),
                    status: 'online'
                });
            } else {
                existingUser.lastSeen = new Date().toISOString();
                existingUser.status = 'online';
            }
            saveTeam();
        }

        // Update last seen every 30 seconds
        setInterval(() => {
            registerUser();
            renderTeam();
        }, 30000);

        function saveTasks() {
            localStorage.setItem(TASKS_KEY, JSON.stringify(tasks));
        }

        function saveChat() {
            localStorage.setItem(CHAT_KEY, JSON.stringify(chatMessages));
        }

        function saveTeam() {
            localStorage.setItem(TEAM_KEY, JSON.stringify(team));
        }

        function renderTasks() {
            const todoList = document.getElementById('todo-list');
            const doingList = document.getElementById('doing-list');
            const doneList = document.getElementById('done-list');

            todoList.innerHTML = '';
            doingList.innerHTML = '';
            doneList.innerHTML = '';

            let todoCount = 0, doingCount = 0, doneCount = 0;

            tasks.forEach(task => {
                const card = createTaskCard(task);

                if (task.status === 'todo') {
                    todoList.appendChild(card);
                    todoCount++;
                } else if (task.status === 'doing') {
                    doingList.appendChild(card);
                    doingCount++;
                } else if (task.status === 'done') {
                    doneList.appendChild(card);
                    doneCount++;
                }
            });

            document.getElementById('todo-count').textContent = todoCount;
            document.getElementById('doing-count').textContent = doingCount;
            document.getElementById('done-count').textContent = doneCount;
        }

        function createTaskCard(task) {
            const card = document.createElement('div');
            card.className = `task-card ${task.status}`;

            let buttons = '';
            if (task.status === 'todo') {
                buttons = `<button class="task-btn claim" onclick="claimTask(${task.id})">Claim</button>`;
            } else if (task.status === 'doing') {
                buttons = `
                    <button class="task-btn complete" onclick="completeTask(${task.id})">Complete</button>
                    <button class="task-btn unclaim" onclick="unclaimTask(${task.id})">Unclaim</button>
                `;
            }

            card.innerHTML = `
                <div class="task-title">${task.title}</div>
                <div class="task-desc">${task.desc}</div>
                <div class="task-meta">
                    <span>Created: ${new Date(task.created).toLocaleDateString()}</span>
                    ${task.assignee ? `<span class="task-assignee">${task.assignee}</span>` : ''}
                </div>
                ${buttons ? `<div class="task-buttons">${buttons}</div>` : ''}
            `;

            return card;
        }

        function claimTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task && userName) {
                task.status = 'doing';
                task.assignee = userName;
                task.claimedAt = new Date().toISOString();
                saveTasks();
                renderTasks();
                addChatMessage(`${userName} claimed: "${task.title}"`);
            }
        }

        function completeTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.status = 'done';
                task.completedAt = new Date().toISOString();
                saveTasks();
                renderTasks();
                addChatMessage(`${userName} completed: "${task.title}" âœ“`);
            }
        }

        function unclaimTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.status = 'todo';
                task.assignee = null;
                saveTasks();
                renderTasks();
                addChatMessage(`${userName} unclaimed: "${task.title}"`);
            }
        }

        function renderChat() {
            const chatDiv = document.getElementById('chat-messages');
            chatDiv.innerHTML = chatMessages.map(msg => `
                <div class="chat-message">
                    <div class="chat-meta">${msg.user} - ${new Date(msg.time).toLocaleTimeString()}</div>
                    <div>${msg.message}</div>
                </div>
            `).join('');
            chatDiv.scrollTop = chatDiv.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();

            if (message && userName) {
                addChatMessage(message);
                input.value = '';
            }
        }

        function addChatMessage(message) {
            chatMessages.push({
                user: userName || 'Anonymous',
                message: message,
                time: new Date().toISOString()
            });
            saveChat();
            renderChat();
        }

        function renderTeam() {
            const teamDiv = document.getElementById('team-list');

            // Mark offline users (not seen in 5 minutes)
            const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000);
            team.forEach(member => {
                const lastSeen = new Date(member.lastSeen);
                member.status = lastSeen > fiveMinutesAgo ? 'online' : 'offline';
            });

            teamDiv.innerHTML = team.map(member => {
                const initials = member.name.split(' ').map(n => n[0]).join('');
                return `
                    <div class="team-member">
                        <div class="team-avatar">${initials}</div>
                        <div class="team-info">
                            <div class="team-name">${member.name}</div>
                            <div class="team-role">${member.status}</div>
                        </div>
                        <div class="team-status ${member.status}"></div>
                    </div>
                `;
            }).join('');

            saveTeam();
        }

        // Allow Enter key to send chat
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Initial render
        renderTasks();
        renderChat();
        renderTeam();

        // Refresh data every 10 seconds
        setInterval(() => {
            tasks = JSON.parse(localStorage.getItem(TASKS_KEY) || '[]');
            chatMessages = JSON.parse(localStorage.getItem(CHAT_KEY) || '[]');
            team = JSON.parse(localStorage.getItem(TEAM_KEY) || '[]');
            renderTasks();
            renderChat();
            renderTeam();
        }, 10000);
    </script>
</body>
</html>
